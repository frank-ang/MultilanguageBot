AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: Multilanguage Bot

Parameters: 
  UserPoolId: 
    Type: String
    # TODO remove  hardcoding.
    Default: us-east-1_PeluZ6Sb7
  CognitoUserPoolArn:
    Type: String
    # TODO remove  hardcoding.
    Default: arn:aws:cognito-idp:us-east-1:331780945983:userpool/us-east-1_PeluZ6Sb7

Resources:
  # FYI, a good reference to setup Cognito Auth per API methods:
  # https://github.com/awslabs/serverless-application-model/blob/master/examples/2016-10-31/api_cognito_auth/template.yaml
  MultilanguageBotApi:
    Type: AWS::Serverless::Api
    Properties:
      StageName: PROD
      Cors: "'*'"
      Auth:
        DefaultAuthorizer: MyCognitoAuthorizer
        Authorizers:
          MyCognitoAuthorizer:
            UserPoolArn: !Ref CognitoUserPoolArn

  MultilanguageBotFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: lex/botTranslator.lambda_handler
      Runtime: python3.6
      CodeUri: ./
      Events:  
        MultilanguageBotApi:
          Type: Api
          Properties:
            RestApiId: !Ref MultilanguageBotApi
            Path: /MultilanguageBot
            Method: POST
            Auth:
              DefaultAuthorizer: MyCognitoAuthInBotYaml
              Authorizers:
                MyCognitoAuthInBotYaml:
                  UserPoolArn: 
                    Ref: CognitoUserPoolArn
      Policies:
       - AWSLambdaExecute # Managed Policy
       - AmazonLexReadOnly # Managed Policy
       - ComprehendReadOnly # Managed Policy
       - AmazonLexRunBotsOnly # Managed Policy
       - TranslateReadOnly # Managed Policy

